---
import MainLayout from '../layouts/MainLayout.astro';
import PricingCard from '../components/PricingCard.astro';
import { sanityClient, queries, type AboutData } from '../lib/sanity';

// Fonction helper pour obtenir l'URL d'une image Sanity
function getImageUrl(image: any): string | null {
  if (!image) return null;

  // Si c'est déjà une string, la retourner
  if (typeof image === 'string') return image;

  // Structure après déréférencement: { asset: { url: string } }
  if (image.asset?.url) return image.asset.url;

  // Structure alternative
  if (image.url) return image.url;

  return null;
}

// Récupérer les données depuis Sanity
const aboutData = await sanityClient.fetch<AboutData>(queries.about);
---

<MainLayout title={aboutData?.title || "Cours & Coaching - Gastronomade"}>
  <!-- Hero Section -->
  <section class="bg-gradient-to-b from-mv-cream to-white py-12 sm:py-16 lg:py-20 relative overflow-hidden">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center relative z-10">
      <h1 class="text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-serif font-bold text-mv-forest mb-3 sm:mb-4 leading-tight">
        {aboutData?.heroTitle || "Cours & Coaching"}
      </h1>
      <p class="text-lg sm:text-xl md:text-2xl text-mv-forest-80 mb-4 sm:mb-6 max-w-3xl mx-auto leading-relaxed">
        {aboutData?.heroSubtitle || "Apprenez l'art de la cuisine santé avec Muriel Cruysmans"}
      </p>
    </div>
  </section>

  <!-- About Muriel Section -->
  <section class="pb-12 sm:pb-16 lg:pb-20 bg-white">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-6 sm:mb-8 lg:mb-10">
        <h2 class="text-2xl sm:text-3xl md:text-4xl font-serif font-bold text-mv-forest mb-3 sm:mb-4 leading-tight">
          {aboutData?.aboutTitle || "À propos de Muriel"}
        </h2>
      </div>

      <div class="bg-mv-cream rounded-lg p-6 sm:p-8 md:p-12 shadow-sm">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 sm:gap-8 lg:gap-12 items-center">
          <div class="space-y-4 sm:space-y-6 order-2 lg:order-1">
            <p class="text-base sm:text-lg text-mv-forest-80 leading-relaxed">
              {aboutData?.bio || "Passionnée de cuisine santé et de bien-être, Muriel Cruysmans est une chef cuisinière diplômée qui met son expertise au service de votre alimentation."}
            </p>
            <div class="space-y-3 sm:space-y-4">
              {aboutData?.achievements ? aboutData.achievements.map((achievement, index) => (
                <div class="flex items-start" key={index}>
                  <svg class="h-5 w-5 text-mv-leaf mr-3 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                  </svg>
                  <span class="text-mv-forest-80 text-sm sm:text-base">{achievement}</span>
                </div>
              )) : (
                <>
                  <div class="flex items-start">
                    <svg class="h-5 w-5 text-mv-leaf mr-3 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                      <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                    </svg>
                    <span class="text-mv-forest-80 text-sm sm:text-base">Diplômée restaurateur-traiteur (mai 2024)</span>
                  </div>
                  <div class="flex items-start">
                    <svg class="h-5 w-5 text-mv-leaf mr-3 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                      <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                    </svg>
                    <span class="text-mv-forest-80 text-sm sm:text-base">Auteur d'un livre de recettes</span>
                  </div>
                  <div class="flex items-start">
                    <svg class="h-5 w-5 text-mv-leaf mr-3 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                      <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                    </svg>
                    <span class="text-mv-forest-80 text-sm sm:text-base">Spécialiste cuisine santé et bien-être</span>
                  </div>
                </>
              )}
            </div>
          </div>
          <div class="bg-white rounded-lg p-4 sm:p-6 shadow-sm order-1 lg:order-2">
            {getImageUrl(aboutData?.photo) ? (
              <img
                src={`${getImageUrl(aboutData?.photo)}?w=500&h=600&fit=crop&auto=format`}
                alt="Muriel Cruysmans"
                class="w-full h-64 sm:h-80 lg:h-96 object-cover rounded-lg"
                loading="lazy"
                onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
              />
            ) : null}
            <div class="aspect-[4/5] bg-gray-200 rounded-lg flex items-center justify-center" style={getImageUrl(aboutData?.photo) ? 'display: none;' : 'display: flex;'}>
              <div class="text-center text-mv-forest-60">
                <svg class="mx-auto h-12 sm:h-16 w-12 sm:w-16 mb-3 sm:mb-4" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                </svg>
                <p class="text-sm sm:text-base font-medium">Photo Muriel Cruysmans</p>
                <p class="text-xs sm:text-sm mt-1 sm:mt-2">Ajoutez une photo dans le Sanity Studio</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Services Section -->
  <section class="pb-12 sm:pb-16 lg:pb-20 bg-mv-cream">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-6 sm:mb-8 lg:mb-10">
        <h2 class="text-2xl sm:text-3xl md:text-4xl font-serif font-bold text-mv-forest mb-3 sm:mb-4 leading-tight">
          Mes Services
        </h2>
        <p class="text-base sm:text-lg text-mv-forest-70 max-w-2xl mx-auto leading-relaxed">
          Cours de cuisine à la carte et coaching personnalisé pour votre bien-être alimentaire
        </p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 sm:gap-8 lg:gap-8">
        {aboutData?.services ? aboutData.services.map((service, index) => (
          <PricingCard
            title={service.title}
            subtitle={service.description}
            price={service.price}
            period=""
            features={service.features}
            priority={String(index + 1)}
            ctaText="En savoir plus"
            ctaLink="/contact"
          />
        )) : (
          <>
            <PricingCard
              title="Balade"
              subtitle="Découverte culinaire"
              price="125€"
              period=""
              features={[
                "Balade gourmande dans la nature",
                "Découverte des produits locaux",
                "Atelier de cueillette",
                "Préparation d'un pique-nique sain",
                "Moment de partage et de convivialité"
              ]}
              priority="1"
              ctaText="Réserver une balade"
              ctaLink="/contact"
            />

            <PricingCard
              title="Conférence"
              subtitle="Nutrition & Bien-être"
              price="250€"
              period=""
              features={[
                "Conférence sur l'alimentation santé",
                "Conseils nutritionnels personnalisés",
                "Échanges avec le public",
                "Support pédagogique",
                "Durée: 1h30"
              ]}
              priority="2"
              ctaText="Organiser une conférence"
              ctaLink="/contact"
            />

            <PricingCard
              title="Ateliers"
              subtitle="Cuisine interactive"
              price="65€"
              period="/pers."
              features={[
                "Atelier cuisine pratique",
                "Préparation de recettes saines",
                "Apprentissage des techniques",
                "Dégustation des préparations",
                "Groupe de 4 à 8 personnes"
              ]}
              priority="3"
              ctaText="S'inscrire à un atelier"
              ctaLink="/contact"
            />
          </>
        )}
      </div>
    </div>
  </section>

  <!-- Call to Action -->
  <section class="pb-12 sm:pb-16 lg:pb-20 bg-mv-forest">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h2 class="text-2xl sm:text-3xl md:text-4xl font-serif font-bold text-mv-cream mb-4 sm:mb-6 leading-tight">
        Prêt à commencer votre voyage culinaire ?
      </h2>
      <p class="text-lg sm:text-xl text-mv-cream-90 mb-6 sm:mb-8 leading-relaxed">
        Contactez-moi pour un cours personnalisé ou un coaching adapté à vos besoins
      </p>
      <a href="/contact" class="inline-block bg-mv-leaf text-mv-cream px-6 sm:px-8 py-3 sm:py-4 rounded-lg font-semibold hover:bg-mv-coral transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-mv-leaf focus:ring-offset-2 focus:ring-offset-mv-forest shadow-md hover:shadow-lg">
        Me contacter
      </a>
    </div>
  </section>
</MainLayout>