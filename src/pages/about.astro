---
import MainLayout from '../layouts/MainLayout.astro';
import PricingCard from '../components/PricingCard.astro';
import { sanityClient, queries, type AboutData } from '../lib/sanity';

// Fonction helper pour obtenir l'URL d'une image Sanity
function getImageUrl(image: any): string | null {
  if (!image) return null;

  // Si c'est déjà une string, la retourner
  if (typeof image === 'string') return image;

  // Structure après déréférencement: { asset: { url: string } }
  if (image.asset?.url) return image.asset.url;

  // Structure alternative
  if (image.url) return image.url;

  return null;
}

// Récupérer les données depuis Sanity
const aboutData = await sanityClient.fetch<AboutData>(queries.about);
---

<MainLayout title={aboutData?.title || "Cours & Coaching - Gastronomade"}>
  <!-- Hero Section -->
  <section class="bg-gradient-to-b from-mv-cream to-white py-16 relative overflow-hidden">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center relative z-10">
   

      <h1 class="text-4xl md:text-6xl font-serif font-bold text-mv-forest mb-6">
        {aboutData?.heroTitle || "Cours & Coaching"}
      </h1>
      <p class="text-xl md:text-2xl text-mv-plum mb-8 max-w-3xl mx-auto">
        {aboutData?.heroSubtitle || "Apprenez l'art de la cuisine santé avec Muriel Cruysmans"}
      </p>
    </div>
  </section>

  <!-- About Muriel Section -->
  <section class="py-0 bg-white">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-12">
        <h2 class="text-3xl md:text-4xl font-serif font-bold text-mv-forest mb-8">
          {aboutData?.aboutTitle || "À propos de Muriel"}
        </h2>
      </div>

      <div class="bg-mv-cream rounded-lg p-8 md:p-12">
        <div class="grid md:grid-cols-2 gap-8 items-center">
          <div class="space-y-6">
            <p class="text-lg text-gray-700 leading-relaxed">
              {aboutData?.bio || "Passionnée de cuisine santé et de bien-être, Muriel Cruysmans est une chef cuisinière diplômée qui met son expertise au service de votre alimentation."}
            </p>
            <div class="space-y-4">
              {aboutData?.achievements ? aboutData.achievements.map((achievement, index) => (
                <div class="flex items-center">
                  <svg class="h-5 w-5 text-vert-foret-doux mr-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                  </svg>
                  <span class="text-gray-700">{achievement}</span>
                </div>
              )) : (
                <>
                  <div class="flex items-center">
                    <svg class="h-5 w-5 text-vert-foret-doux mr-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                    </svg>
                    <span class="text-gray-700">Diplômée restaurateur-traiteur (mai 2024)</span>
                  </div>
                  <div class="flex items-center">
                    <svg class="h-5 w-5 text-vert-foret-doux mr-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                    </svg>
                    <span class="text-gray-700">Auteur d'un livre de recettes</span>
                  </div>
                  <div class="flex items-center">
                    <svg class="h-5 w-5 text-vert-foret-doux mr-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                    </svg>
                    <span class="text-gray-700">Spécialiste cuisine santé et bien-être</span>
                  </div>
                </>
              )}
            </div>
          </div>
          <div class="bg-white rounded-lg p-6 shadow-sm">
            {getImageUrl(aboutData?.photo) ? (
              <img
                src={getImageUrl(aboutData?.photo)}
                alt="Muriel Cruysmans"
                class="w-full h-full object-cover rounded-lg"
                onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
              />
            ) : null}
            <div class="aspect-square bg-gray-200 rounded-lg flex items-center justify-center" style={getImageUrl(aboutData?.photo) ? 'display: none;' : 'display: flex;'}>
              <div class="text-center text-gray-500">
                <svg class="mx-auto h-16 w-16 mb-4" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                </svg>
                <p>Photo Muriel Cruysmans</p>
                <p class="text-sm mt-2">Ajoutez une photo dans le Sanity Studio</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Services Section -->
  <section class="py-16 bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-12">
        <h2 class="text-3xl md:text-4xl font-serif font-bold text-vert-foret mb-4">
          Mes Services
        </h2>
        <p class="text-lg text-gray-600 max-w-2xl mx-auto">
          Cours de cuisine à la carte et coaching personnalisé pour votre bien-être alimentaire
        </p>
      </div>

      <div class="grid md:grid-cols-3 gap-8">
        {aboutData?.services ? aboutData.services.map((service, index) => (
          <PricingCard
            title={service.title}
            subtitle={service.description}
            price={service.price}
            period=""
            features={service.features}
            priority={String(index + 1)}
            ctaText="En savoir plus"
            ctaLink="/contact"
          />
        )) : (
          <>
            <PricingCard
              title="Balade"
              subtitle="Découverte culinaire"
              price="125€"
              period=""
              features={[
                "Balade gourmande dans la nature",
                "Découverte des produits locaux",
                "Atelier de cueillette",
                "Préparation d'un pique-nique sain",
                "Moment de partage et de convivialité"
              ]}
              priority="1"
              ctaText="Réserver une balade"
              ctaLink="/contact"
            />

            <PricingCard
              title="Conférence"
              subtitle="Nutrition & Bien-être"
              price="250€"
              period=""
              features={[
                "Conférence sur l'alimentation santé",
                "Conseils nutritionnels personnalisés",
                "Échanges avec le public",
                "Support pédagogique",
                "Durée: 1h30"
              ]}
              priority="2"
              ctaText="Organiser une conférence"
              ctaLink="/contact"
            />

            <PricingCard
              title="Ateliers"
              subtitle="Cuisine interactive"
              price="65€"
              period="/pers."
              features={[
                "Atelier cuisine pratique",
                "Préparation de recettes saines",
                "Apprentissage des techniques",
                "Dégustation des préparations",
                "Groupe de 4 à 8 personnes"
              ]}
              priority="3"
              ctaText="S'inscrire à un atelier"
              ctaLink="/contact"
            />
          </>
        )}
      </div>
    </div>
  </section>

  <!-- Call to Action -->
  <section class="py-16 bg-mv-forest">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h2 class="text-3xl md:text-4xl font-serif font-bold text-mv-cream mb-6">
        Prêt à commencer votre voyage culinaire ?
      </h2>
      <p class="text-xl text-mv-cream/90 mb-8">
        Contactez-moi pour un cours personnalisé ou un coaching adapté à vos besoins
      </p>
      <a href="/contact" class="inline-block bg-mv-leaf text-mv-cream px-8 py-4 rounded-lg font-semibold hover:bg-mv-amber hover:scale-105 transition-all duration-300 transform shadow-md hover:shadow-lg">
        Me contacter
      </a>
    </div>
  </section>
</MainLayout>