---
import MainLayout from '../layouts/MainLayout.astro';
import Section from '../components/Section.astro';
import PricingCard from '../components/PricingCard.astro';
import RestaurantSection from '../components/RestaurantSection.astro';
import {
  getCompanyAgendaData,
  getHomeData,
  getLocationsData,
  getRestaurantData,
  type CompanyAgendaSlot,
  type LocationData,
} from '../lib/sanity';

const fallbackAgendaSlots: CompanyAgendaSlot[] = [
  {
    date: '2026-02-19',
    status: 'Indisponible'
  },
  {
    date: '2026-03-04',
    status: 'Indisponible'
  },
  {
    date: '2026-03-18',
    status: 'Indisponible'
  }
];

// Récupérer les données depuis Sanity (en parallèle pour réduire le TTFB)
const [locations, restaurantData, homeData, companyAgenda] = await Promise.all([
  getLocationsData(),
  getRestaurantData(),
  getHomeData(),
  getCompanyAgendaData()
]);

const fallbackHeroDescription = "À Wavre, à 1 km de la E411, Gastronomade accueille réunions, événements privés et dîners. Un cadre naturel, chaleureux et simple d’accès.";

// Organiser les locations par type
const hasLocationData = locations.length > 0
const visibleLocations = locations.filter(loc => loc.isVisible !== false);
const societeLocations = visibleLocations.filter(loc => loc.type === 'societe');
const priveLocations = visibleLocations.filter(loc => loc.type === 'prive');

const agendaSlots = (companyAgenda?.slots && companyAgenda.slots.length > 0 ? companyAgenda.slots : fallbackAgendaSlots)
  .filter((slot) => slot?.isVisible !== false)
  .slice()
  .sort((a, b) => {
    const aDate = a?.date ? new Date(a.date).getTime() : Infinity;
    const bDate = b?.date ? new Date(b.date).getTime() : Infinity;
    return aDate - bDate;
  });

const statusPalette: Record<string, {background: string; text: string; dot: string}> = {
  disponible: {
    background: 'bg-mv-forest border border-mv-forest',
    text: 'text-mv-cream',
    dot: 'bg-mv-forest'
  },
  indisponible: {
    background: 'bg-mv-plum border border-mv-plum',
    text: 'text-mv-cream',
    dot: 'bg-mv-plum'
  }
}

const normalizeStatusKey = (status?: string) => {
  const normalized = (status ?? 'disponible').trim().toLowerCase()
    .replace(/[éèê]/g, 'e')
    .replace(/[àâ]/g, 'a')
  if (normalized.includes('complet')) return 'indisponible'
  if (normalized.includes('indisponible')) return 'indisponible'
  return 'disponible'
}

const getStatusTheme = (status?: string) => statusPalette[normalizeStatusKey(status)] ?? statusPalette.disponible
const getStatusBackground = (status?: string) => {
  const theme = getStatusTheme(status)
  return `${theme.background} ${theme.text}`
}

const getStatusDotClass = (status?: string) => getStatusTheme(status).dot

const normalizeSlotDateKey = (value?: string) => {
  if (!value) return '';
  const trimmed = value.split('T')[0];
  if (/^\\d{4}-\\d{2}-\\d{2}$/.test(trimmed)) {
    return trimmed;
  }
  const parsed = new Date(value);
  if (Number.isNaN(parsed.getTime())) return '';
  const year = parsed.getUTCFullYear();
  const month = String(parsed.getUTCMonth() + 1).padStart(2, '0');
  const day = String(parsed.getUTCDate()).padStart(2, '0');
  return `${year}-${month}-${day}`;
};

const slotsByDate: Record<string, CompanyAgendaSlot[]> = {};
agendaSlots.forEach(slot => {
  const key = normalizeSlotDateKey(slot?.date);
  if (!key) return;
  if (!slotsByDate[key]) {
    slotsByDate[key] = [];
  }
  slotsByDate[key].push(slot);
});

const debugDateKeys = Object.keys(slotsByDate);

const getBaseCalendarDate = (slots: CompanyAgendaSlot[]) => {
  for (const slot of slots) {
    if (!slot?.date) continue;
    const parsed = new Date(slot.date);
    if (!Number.isNaN(parsed.getTime())) {
      return parsed;
    }
  }
  return new Date();
};

const calendarBaseDate = getBaseCalendarDate(agendaSlots);
const calendarWeekDays = ['Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam', 'Dim'];
const calendarLegendStates = [
  { label: 'Disponible', status: 'Disponible' },
  { label: 'Indisponible', status: 'Indisponible' }
];

const determineCellStatusLabel = (slots: CompanyAgendaSlot[]) => {
  if (!slots || slots.length === 0) return 'Disponible';
  const normalized = slots
    .map(slot => (slot.status ?? 'Disponible').toLowerCase())
    .map(status => status.replace(/[éèê]/g, 'e'));
  if (normalized.some(status => status.includes('indisponible'))) return 'Indisponible';
  return 'Disponible';
};

const buildCalendarCells = (
  year: number,
  month: number,
  dates: Record<string, CompanyAgendaSlot[]>
) => {
  const firstOfMonth = new Date(year, month, 1);
  const firstWeekday = ((firstOfMonth.getDay() + 6) % 7);
  const daysInMonth = new Date(year, month + 1, 0).getDate();
  const totalCells = firstWeekday + daysInMonth;
  const rows = Math.ceil(totalCells / 7);
  const cells = [];

  for (let index = 0; index < rows * 7; index += 1) {
    const dayIndex = index - firstWeekday + 1;
    const isCurrentMonth = index >= firstWeekday && dayIndex <= daysInMonth;
    const day = isCurrentMonth ? dayIndex : undefined;
    const dateKey = isCurrentMonth ? `${year}-${String(month + 1).padStart(2, '0')}-${String(dayIndex).padStart(2, '0')}` : undefined;
    const slots = dateKey ? dates[dateKey] ?? [] : [];
    const status = determineCellStatusLabel(slots);

    cells.push({
      day,
      dateKey,
      slots,
      isCurrentMonth,
      status
    });
  }

  return cells;
};

const monthsToShow = Math.max(1, Math.min(4, companyAgenda?.monthsToShow ?? 2));
const startMonthCandidate = companyAgenda?.startMonth ? new Date(companyAgenda.startMonth) : calendarBaseDate;
const normalizedStartMonthCandidate = Number.isNaN(startMonthCandidate.getTime())
  ? new Date(calendarBaseDate.getFullYear(), calendarBaseDate.getMonth(), 1)
  : new Date(startMonthCandidate.getFullYear(), startMonthCandidate.getMonth(), 1);
const hasSlotInStartMonth = debugDateKeys.some(dateKey => dateKey.startsWith(
  `${normalizedStartMonthCandidate.getFullYear()}-${String(normalizedStartMonthCandidate.getMonth() + 1).padStart(2, '0')}`
));
const normalizedStartMonth = hasSlotInStartMonth
  ? normalizedStartMonthCandidate
  : new Date(calendarBaseDate.getFullYear(), calendarBaseDate.getMonth(), 1);

const calendarMonths = Array.from({ length: monthsToShow }, (_, monthIndex) => {
  const monthDate = new Date(normalizedStartMonth.getFullYear(), normalizedStartMonth.getMonth() + monthIndex, 1);
  return {
    label: monthDate.toLocaleDateString('fr-FR', { month: 'long', year: 'numeric' }),
    year: monthDate.getFullYear(),
    month: monthDate.getMonth()
  };
});

const monthlyCalendars = calendarMonths.map(calendar => ({
  ...calendar,
  cells: buildCalendarCells(calendar.year, calendar.month, slotsByDate)
}));

const fallbackRestaurantDates = [
  '2026-03-05',
  '2026-03-19',
  '2026-04-09',
  '2026-04-23',
  '2026-05-07',
  '2026-05-21'
];

const toIsoDate = (value?: string) => {
  if (!value) return undefined;
  const trimmed = value.split('T')[0];
  if (/^\\d{4}-\\d{2}-\\d{2}$/.test(trimmed)) {
    return trimmed;
  }
  const parsed = new Date(value);
  if (Number.isNaN(parsed.getTime())) return undefined;
  return parsed.toISOString();
};

const baseUrl = Astro.site ? Astro.site.toString().replace(/\/$/, '') : Astro.url.origin;

const restaurantDateSlots = (restaurantData?.dateSlots && restaurantData.dateSlots.length > 0)
  ? restaurantData.dateSlots.filter((slot) => slot?.isVisible !== false)
  : [];

const restaurantSlots = (restaurantDateSlots.length > 0 ? restaurantDateSlots : fallbackRestaurantDates.map(date => ({
  date,
  status: 'Disponible'
})))
  .slice(0, 8)
  .map(slot => ({
    date: slot?.date,
    status: slot?.status || 'Disponible'
  }))

const showRestaurant = restaurantData?.isVisible !== false
// Le calendrier reste masqué tant que `isVisible` n’est pas explicitement true dans Sanity.
const showCompanyAgenda = companyAgenda?.isVisible === true

const restaurantEventsJsonLd = showRestaurant
  ? restaurantSlots
      .filter((slot) => slot?.date)
      .map((slot) => {
        const startDate = toIsoDate(slot?.date);
        if (!startDate) return null;
        const isFull = (slot?.status || '').toLowerCase().includes('complet');
        return {
          "@context": "https://schema.org",
          "@type": "Event",
          "name": restaurantData?.title || "Restaurant éphémère",
          "description": restaurantData?.menuDescription || homeData?.restaurantSectionDescription,
          "startDate": startDate,
          "eventStatus": "https://schema.org/EventScheduled",
          "eventAttendanceMode": "https://schema.org/OfflineEventAttendanceMode",
          "location": {
            "@type": "Place",
            "name": "Gastronomade",
            "address": "Wavre, Belgique"
          },
          "offers": {
            "@type": "Offer",
            "price": typeof restaurantData?.price === 'number' ? restaurantData.price : undefined,
            "priceCurrency": "EUR",
            "availability": isFull ? "https://schema.org/SoldOut" : "https://schema.org/InStock",
            "url": `${baseUrl}/#restaurant-section`
          },
          "organizer": {
            "@type": "Organization",
            "name": "Gastronomade",
            "url": baseUrl
          }
        };
      })
      .filter(Boolean)
  : [];

const heroBackgroundUrl = homeData?.heroBackgroundImage?.asset?.url
const homeHero = homeData?.hero
const homeHeroBackgroundUrl = homeHero?.imageUrl || heroBackgroundUrl
const homeHeroKicker = homeHero?.kicker || homeData?.heroSubtitle || 'Gastronomade'
const homeHeroTitle = homeHero?.title || homeData?.heroTitle || 'Un lieu d’exception pour vos rencontres.'
const homeHeroSubtitle = homeHero?.subtitle || homeData?.heroDescription || fallbackHeroDescription
const homeHeroCtaCountRaw = Number(homeHero?.ctaCount ?? 2)
const homeHeroCtaCount = homeHeroCtaCountRaw >= 2 ? 2 : 1
const homeHeroPrimaryCtaLabel = homeHero?.primaryCtaLabel || 'Réserver une date'
const homeHeroPrimaryCtaUrl = homeHero?.primaryCtaUrl || '/contact'
const homeHeroSecondaryCtaLabel = homeHero?.secondaryCtaLabel || 'Découvrir les offres'
const homeHeroSecondaryCtaUrl = homeHero?.secondaryCtaUrl || '#location-section'
const pageDescription = (homeData?.heroDescription || fallbackHeroDescription).trim();
const pageImage = heroBackgroundUrl
  ? `${heroBackgroundUrl}?w=1200&h=630&fit=crop&auto=format`
  : undefined;
const locationGallery = (homeData?.locationGallery || []).filter((image) => image?.url)
const whyHereItems = [
  "En pleine nature, à 1 km de la E411",
  "Maison en bois, chauffée au poêle",
  "Jusqu’à 14 personnes",
  "Terrasse et parking facile"
]

const buildLocationFeatures = (location?: LocationData) => {
  const base = location?.features || []
  const details = location?.details || []
  return [...base, ...details]
}
---

<MainLayout
  title={homeData?.title || "Gastronomade - Manger Vrai | Muriel Cruysmans"}
  description={pageDescription}
  image={pageImage}
  jsonLd={restaurantEventsJsonLd}
>
  <!-- Hero Section -->
  <Section class="relative overflow-hidden bg-white fade-in-up" role="banner">
    {homeHeroBackgroundUrl && (
      <div class="pointer-events-none absolute inset-0 hidden lg:block">
        <div
          class="absolute inset-y-0 right-0 w-2/3 bg-cover bg-center hero-image-mask"
          style={`background-image: url(${homeHeroBackgroundUrl}?w=1800&auto=format);`}
          aria-hidden="true"
        />
        <div
          class="absolute inset-y-0 right-0 w-2/3 bg-[linear-gradient(to_left,transparent_0%,transparent_33%,rgba(255,255,255,0.6)_52%,rgba(255,255,255,0.92)_72%,white_100%)]"
          aria-hidden="true"
        />
      </div>
    )}
    <div class="relative z-10" slot="content">
      <div class="grid grid-cols-1 lg:grid-cols-12 gap-10 items-center">
        <div class="lg:col-span-7 space-y-5 sm:space-y-6">
          <p class="mv-kicker">{homeHeroKicker}</p>
          <h1 class="mv-hero-title max-w-3xl">
            {homeHeroTitle}
          </h1>
          <p class="mv-hero-subtitle max-w-3xl text-mv-forest-80">
            {homeHeroSubtitle}
          </p>
          <div class="flex flex-wrap gap-3 pt-1">
            <a
              href={homeHeroPrimaryCtaUrl}
              class="mv-btn mv-btn-primary bg-mv-forest text-white shadow-lg hover:bg-mv-plum transition"
            >
              {homeHeroPrimaryCtaLabel}
            </a>
            {homeHeroCtaCount === 2 && homeHeroSecondaryCtaLabel && homeHeroSecondaryCtaUrl && (
              <a
                href={homeHeroSecondaryCtaUrl}
                class="mv-btn mv-btn-secondary border-mv-forest text-mv-forest hover:bg-mv-forest hover:text-mv-cream"
              >
                {homeHeroSecondaryCtaLabel}
              </a>
            )}
          </div>
        </div>
      </div>
    </div>
  </Section>

  <!-- Gastronomade Section -->
  <Section class="bg-white fade-in-up scroll-fade-in" id="location-section" tight={true}>
    <div class="max-w-3xl" slot="content">
      <p class="mv-kicker">Deux expériences</p>
      <h2 class="mv-section-title">
        {homeData?.locationSectionTitle || 'Privatisation & restaurant éphémère'}
      </h2>
      <p class="mv-lead text-mv-forest-70">
        {homeData?.locationSectionDescription || 'Deux offres complémentaires, un même esprit : chaleur, nature et cuisine sincère.'}
      </p>
    </div>

    <div class="relative mt-10" slot="content">
      <div class="pointer-events-none absolute -top-10 left-10 h-24 w-24 rounded-full bg-mv-leaf-10 blur-3xl"></div>
      <div class="pointer-events-none absolute -bottom-10 right-6 h-28 w-28 rounded-full bg-mv-coral-20 blur-3xl"></div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 lg:gap-8 items-start">
        <!-- Sociétés -->
          <div class="scroll-slide-in-left">
            {societeLocations.length > 0 ? (
              <PricingCard
                title={societeLocations[0].title}
                subtitle={societeLocations[0].subtitle || "Réunions & Team-Buildings"}
                price={societeLocations[0].price}
                period="HTVA"
                features={buildLocationFeatures(societeLocations[0])}
                imageUrl={societeLocations[0].imageUrl ? `${societeLocations[0].imageUrl}?w=600&h=400&fit=crop&auto=format` : undefined}
                imageAlt={societeLocations[0].title}
                ctaText="Voir l’offre entreprises"
                ctaLink="/privatisation-entreprise-wavre"
              />
            ) : !hasLocationData ? (
              <PricingCard
                title="Sociétés"
                subtitle="Réunions & Team-Buildings"
                price="400€"
                period="HTVA"
                features={[]}
                ctaText="Voir l’offre entreprises"
                ctaLink="/privatisation-entreprise-wavre"
              />
            ) : null}
          </div>

          <!-- Privé -->
          <div class="scroll-fade-in">
            {priveLocations.length > 0 ? (
              <PricingCard
                title={priveLocations[0].title}
                subtitle={priveLocations[0].subtitle || "Événements privés"}
                price={priveLocations[0].price}
                period="HTVA"
                features={buildLocationFeatures(priveLocations[0])}
                imageUrl={priveLocations[0].imageUrl ? `${priveLocations[0].imageUrl}?w=600&h=400&fit=crop&auto=format` : undefined}
                imageAlt={priveLocations[0].title}
                ctaText={priveLocations[0].ctaLabel || "Organiser mon événement"}
                ctaLink="/evenements-prives-wavre"
              />
            ) : !hasLocationData ? (
              <PricingCard
                title="Privé"
                subtitle="Événements privés"
                price="400€"
                period="HTVA"
                features={[]}
                ctaText="Organiser mon événement"
                ctaLink="/evenements-prives-wavre"
              />
            ) : null}
          </div>

          <!-- Restaurant -->
          {showRestaurant && (
            <div class="scroll-slide-in-right">
              <PricingCard
                title={restaurantData?.title || "Restaurant éphémère"}
                subtitle={restaurantData?.subtitle || "Un jeudi par mois"}
                price={restaurantData?.price ? `${restaurantData.price}€` : "50€"}
                period="/pers."
                features={restaurantData?.highlights || []}
                ctaText="Voir les prochaines dates"
                ctaLink="/restaurant-wavre#restaurant-section"
                imageUrl={restaurantData?.imageUrl ? `${restaurantData.imageUrl}?w=600&h=400&fit=crop&auto=format` : undefined}
                imageAlt={restaurantData?.imageAlt || restaurantData?.title || "Restaurant éphémère"}
                highlight="true"
              />
            </div>
          )}
      </div>
    </div>

    {locationGallery.length > 0 && (
      <div class="mt-10" slot="content">
        <div class="flex flex-col gap-2 sm:flex-row sm:items-end sm:justify-between mb-5">
          <div>
            <p class="mv-kicker">Le lieu en images</p>
            <h3 class="text-xl sm:text-2xl font-serif font-semibold text-mv-forest">
              Découvrez l’atmosphère
            </h3>
          </div>
          <p class="text-sm text-mv-forest-60 max-w-lg">
            Lumière naturelle, table conviviale, coins cosy et espaces modulables.
          </p>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
          {locationGallery.slice(0, 6).map((image, index) => {
            const imageCardClass = index === 0
              ? 'group relative overflow-hidden rounded-2xl border border-mv-leaf-20 bg-mv-cream-80 sm:col-span-2 lg:col-span-2'
              : 'group relative overflow-hidden rounded-2xl border border-mv-leaf-20 bg-mv-cream-80';
            return (
              <figure class={imageCardClass}>
                <img
                  src={`${image.url}?w=900&h=600&fit=crop&auto=format`}
                  alt={image.alt || 'Photo du lieu'}
                  class="h-56 sm:h-64 w-full object-cover transition-transform duration-500 group-hover:scale-105"
                  loading="lazy"
                  decoding="async"
                  width="900"
                  height="600"
                  sizes="(min-width: 1024px) 33vw, (min-width: 640px) 50vw, 100vw"
                />
                <div class="absolute inset-0 bg-gradient-to-t from-mv-cream/80 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                {image.alt && (
                  <figcaption class="absolute bottom-3 left-3 rounded-full bg-mv-cream-80 px-3 py-1 text-xs uppercase tracking-[0.18em] text-mv-forest-70">
                    {image.alt}
                  </figcaption>
                )}
              </figure>
            );
          })}
        </div>
      </div>
    )}

    <div class="mt-8 w-full" slot="content">
      <div class="rounded-2xl border border-mv-leaf-10 bg-white/70 px-4 py-3">
        <p class="text-xs uppercase tracking-[0.2em] text-mv-forest-50 mb-3 text-center">
          Pourquoi ici ?
        </p>
        <ul class="grid grid-cols-2 sm:grid-cols-4 gap-3 text-xs sm:text-sm text-mv-forest-70 w-full">
          {whyHereItems.map((feature) => (
            <li class="flex items-center justify-center gap-2 text-center">
              <span class="h-1 w-1 rounded-full bg-mv-leaf/60" aria-hidden="true"></span>
              <span>{feature}</span>
            </li>
          ))}
        </ul>
      </div>
    </div>
  </Section>

  <!-- Restaurant Section -->
  {showRestaurant && (
    <RestaurantSection
      id="restaurant-section"
      sectionClass="bg-white scroll-fade-in"
      restaurantData={restaurantData}
      homeData={homeData}
      ctaHref="/contact"
    />
  )}

  <!-- Agenda Entreprises Section -->
  {showCompanyAgenda && (
    <Section id="entreprise-agenda" class="bg-mv-cream" tight={true} containerClass="max-w-5xl" aria-labelledby="entreprise-agenda-title">
      <div class="flex flex-col gap-3 lg:flex-row lg:items-start lg:justify-between" id="entreprise-agenda-title" slot="content">
        <div class="max-w-2xl">
          <p class="mv-kicker mb-1">Entreprises</p>
          <h2 class="mv-section-title">
            {companyAgenda?.calendarTitle || "Disponibilités entreprises"}
          </h2>
          <p class="mt-2 text-sm text-mv-forest-70">
            Planifiez votre journée d’équipe dans un lieu qui respire.
          </p>
        </div>
        <div class="flex flex-col items-start gap-2">
          <a
            href="/contact"
            class="mv-btn mv-btn-secondary border-mv-forest bg-white px-4 py-1 text-xs text-mv-forest transition hover:bg-mv-forest/5"
          >
            Réserver un créneau
          </a>
        </div>
      </div>

      <div class="mt-6 space-y-4" slot="content">
        <div class="flex items-center justify-between gap-4">
          <span id="enterprise-calendar-current" class="text-sm font-semibold uppercase tracking-[0.2em] text-mv-forest-60">
            {monthlyCalendars.length ? monthlyCalendars[0].label : ''}
          </span>
          <div class="flex gap-2">
            <button
              type="button"
              id="enterprise-calendar-prev"
              class="rounded-full border border-mv-forest/40 px-3 py-1 text-xs font-semibold uppercase tracking-[0.2em] text-mv-forest transition hover:bg-mv-forest/5"
            >
              Préc.
            </button>
            <button
              type="button"
              id="enterprise-calendar-next"
              class="rounded-full border border-mv-forest/40 px-3 py-1 text-xs font-semibold uppercase tracking-[0.2em] text-mv-forest transition hover:bg-mv-forest/5"
            >
              Suiv.
            </button>
          </div>
        </div>

        <div class="flex flex-wrap gap-3 text-xs font-semibold uppercase tracking-[0.2em] text-mv-forest-50">
          {calendarLegendStates.map(state => (
            <span key={state.label} class="flex items-center gap-1">
              <span
                class={`inline-flex h-2 w-2 rounded-full ${getStatusDotClass(state.status)}`}
                aria-hidden="true"
              ></span>
              {state.label}
            </span>
          ))}
        </div>

        <div class="relative">
          {monthlyCalendars.map((month, index) => (
            <div
              key={month.label}
              data-calendar-month-index={index}
              data-calendar-label={month.label}
              class={`space-y-2 rounded-2xl border border-mv-leaf-20 bg-white p-4 shadow-lg transition ${
                index === 0 ? '' : 'hidden'
              }`}
            >
              <div class="grid grid-cols-7 gap-[1px] text-xs font-semibold uppercase tracking-[0.2em] text-mv-forest-60">
                {calendarWeekDays.map(day => (
                  <span key={`${month.label}-${day}`}>{day}</span>
                ))}
              </div>
              <div class="grid grid-cols-7 gap-1 text-xs">
                {month.cells.map((cell, cellIndex) => (
                  <div
                    key={`${month.label}-${cell.dateKey ?? 'empty'}-${cellIndex}`}
                    class={`flex h-10 items-center justify-center rounded-lg text-xs font-semibold transition ${
                      cell.isCurrentMonth
                        ? `${getStatusBackground(cell.status)} shadow-mv-forest-5`
                        : 'bg-mv-cream-80 border border-mv-leaf-20 text-mv-forest-50'
                    }`}
                  >
                    {cell.day ?? ''}
                  </div>
                ))}
              </div>
            </div>
          ))}
        </div>
      </div>
    </Section>
    <script type="module">
      (() => {
        const months = Array.from(document.querySelectorAll('[data-calendar-month-index]'))
        if (!months.length) return
        const prev = document.getElementById('enterprise-calendar-prev')
        const next = document.getElementById('enterprise-calendar-next')
        const label = document.getElementById('enterprise-calendar-current')
        let currentIndex = 0

        const update = index => {
          months.forEach((month, idx) => {
            const isActive = idx === index
            month.classList.toggle('hidden', !isActive)
            month.setAttribute('aria-hidden', (!isActive).toString())
          })
          if (label) {
            label.textContent = months[index]?.dataset.calendarLabel ?? ''
          }
        }

        prev?.addEventListener('click', () => {
          currentIndex = (currentIndex - 1 + months.length) % months.length
          update(currentIndex)
        })

        next?.addEventListener('click', () => {
          currentIndex = (currentIndex + 1) % months.length
          update(currentIndex)
        })
        update(0)
      })()
    </script>
  )}

  <Section class="bg-white scroll-fade-in">
    <div class="max-w-3xl" slot="content">
      <p class="mv-kicker">À propos</p>
      <h2 class="mv-section-title">Muriel, bio et accompagnements</h2>
      <p class="mv-lead text-mv-forest-70">
        Découvrez le parcours de Muriel, puis les formats Cours & Coaching pour choisir l’accompagnement le plus adapté.
      </p>
    </div>

    <div class="mt-6 flex flex-wrap gap-3" slot="content">
      <a
        href="/auteur"
        class="mv-btn mv-btn-primary bg-mv-forest text-mv-cream hover:bg-mv-leaf"
      >
        Voir la bio de Muriel
      </a>
      <a
        href="/about"
        class="mv-btn mv-btn-secondary border-mv-forest text-mv-forest hover:bg-mv-forest hover:text-mv-cream"
      >
        Voir Cours & Coaching
      </a>
    </div>
  </Section>
</MainLayout>
